<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; padding: 20px; background-color: #f4f7f6; color: #333; }
    .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .form-group { margin-bottom: 15px; }
    label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 14px; }
    input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
    button { width: 100%; padding: 12px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: bold; }
    button:disabled { background: #ccc; }
    .search-box { background: #e9ecef; padding: 15px; border-radius: 8px; margin-bottom: 25px; border: 1px solid #dee2e6; }
    #resultsTable { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; }
    #resultsTable th, #resultsTable td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    #resultsTable th { background-color: #007bff; color: white; }
    .success-msg { color: green; font-weight: bold; margin-top: 10px; display: none; }
  </style>
</head>
<body>

<div class="container">
  <div class="search-box">
    <label>üîç Cari Pelanggan (Nama / ID CST)</label>
    <input type="text" id="searchInput" placeholder="Ketik minimal 3 huruf...">
    <div id="searchStatus" style="font-size: 11px; margin-top: 5px;"></div>
    <table id="resultsTable" style="display:none;">
      <thead>
        <tr><th>Nama</th><th>ID CST</th><th>Paket</th>Alamat</tr>
      </thead>
      <tbody id="resultsBody"></tbody>
    </table>
  </div>

  <hr>

  <form id="mainForm">
    <h3>Form Input Rekapan</h3>
    
    <div class="form-group">
      <label>Nama Pelanggan</label>
      <input type="text" name="Nama" id="inpNama" required>
    </div>

    <div class="form-group">
      <label>ID CST</label>
      <input type="text" name="ID_CST" id="inpID" required>
    </div>

    <div class="form-group">
      <label>Paket</label>
      <select name="Paket" id="paketSelect" required></select>
    </div>

    <div class="form-group">
      <label>Point</label>
      <select name="Point" required>
        <option value="0.25">0.25</option>
        <option value="1">1</option>
        <option value="2">2</option>
      </select>
    </div>

    <div class="form-group">
      <label>Bonus</label>
      <select name="Bonus" id="bonusSelect" required></select>
    </div>
<div class="form-group">
  <label>Tanggal</label>
  <input type="date" name="Tanggal">
</div>

<div class="form-group"><label>Billing</label><input type="text" name="Billing"></div>
<div class="form-group"><label>Email</label><input type="text" name="Email"></div>
<div class="form-group"><label>Japo</label><input type="text" name="Japo"></div>

<div class="form-group">
  <label>No HP (Otomatis ke wa.me)</label>
  <input type="text" id="no_hp" name="No_HP" placeholder="Contoh: 08123456789">
  <small id="wa_link_preview" style="display:block; color: blue;"></small>
</div>

<div class="form-group"><label>Alamat</label><textarea name="Alamat"></textarea></div>

<script>
  const inputHp = document.getElementById('no_hp');
  const preview = document.getElementById('wa_link_preview');

  inputHp.addEventListener('input', function(e) {
    let num = e.target.value;

    // 1. Hapus semua karakter yang bukan angka
    num = num.replace(/\D/g, '');

    // 2. Ubah awalan 0 menjadi 62
    if (num.startsWith('0')) {
      num = '62' + num.slice(1);
    }

    // 3. Update nilai input jika ingin langsung berubah di kotak teks
    // e.target.value = num; 

    // 4. Tampilkan preview link wa.me
    if (num.length > 5) {
      preview.innerText = "Link WA: https://wa.me/" + num;
    } else {
      preview.innerText = "";
    }
  });
</script>
    <button type="submit" id="submitBtn">SIMPAN KE DATABASE</button>
    <div id="successMsg" class="success-msg">‚úÖ Data berhasil disimpan!</div>
  </form>
</div>

<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxgZw6JAn-S-uXKTiZm6k0Kzrut10JlImRSn1Qn0XeZ-zv3WjYnA9rtgSJfnOY01VpS/exec"; // GANTI DENGAN URL DEPLOY ANDA

  // 1. ISI DROPDOWN OTOMATIS
  const paketSelect = document.getElementById('paketSelect');
  const bonusSelect = document.getElementById('bonusSelect');

  // Paket 10 - 500 Mbps
  const listPaket = [10, 15, 20, 30, 40, 50, 75, 100, 150, 200, 300, 500];
  listPaket.forEach(v => {
    let opt = new Option(v + " Mbps", v + "Mbps");
    paketSelect.add(opt);
  });

  // Bonus 25k - 1jt
  const listBonus = [25000, 50000, 100000, 150000, 200000, 300000, 400000, 500000, 600000, 750000, 1000000];
  listBonus.forEach(v => {
    let opt = new Option("Rp " + v.toLocaleString('id-ID'), v);
    bonusSelect.add(opt);
  });

  // 2. LOGIKA PENCARIAN
  document.getElementById('searchInput').addEventListener('input', function() {
    const val = this.value;
    const body = document.getElementById('resultsBody');
    const table = document.getElementById('resultsTable');
    
    if (val.length < 3) {
      table.style.display = 'none';
      return;
    }

    fetch(`${SCRIPT_URL}?search=${val}`)
      .then(res => res.json())
      .then(data => {
        body.innerHTML = '';
        if (data.length > 0) {
          table.style.display = 'table';
          data.forEach(item => {
            let row = body.insertRow();
            row.innerHTML = `<td>${item.nama}</td><td>${item.id_cst}</td><td>${item.paket}</td>`;
            row.style.cursor = "pointer";
            row.onclick = () => {
              document.getElementById('inpNama').value = item.nama;
              document.getElementById('inpID').value = item.id_cst;
              table.style.display = 'none';
            };
          });
        }
      });
  });

  // 3. SIMPAN DATA
  document.getElementById('mainForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const btn = document.getElementById('submitBtn');
    btn.disabled = true;
    btn.innerHTML = "Sedang Menyimpan...";

    fetch(SCRIPT_URL, {
      method: 'POST',
      body: new FormData(this)
    })
    .then(res => res.json())
    .then(res => {
      if (res.result === 'duplicate') {
        alert("‚ö†Ô∏è Nama sudah ada di database!");
      } else if (res.result === 'success') {
        document.getElementById('successMsg').style.display = 'block';
        this.reset();
        setTimeout(() => { document.getElementById('successMsg').style.display = 'none'; }, 3000);
      }
      btn.disabled = false;
      btn.innerHTML = "SIMPAN KE DATABASE";
    })
    .catch(err => {
      alert("Error simpan. Cek koneksi.");
      btn.disabled = false;
    });
  });
</script>

</body>
</html>


