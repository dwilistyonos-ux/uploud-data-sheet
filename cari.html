<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cari Pelanggan</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 p-5 font-sans text-slate-100 flex flex-col items-center">

  <div class="max-w-md w-full bg-slate-800 rounded-3xl p-6 shadow-2xl mb-6 border border-slate-700">
    <h2 class="text-2xl font-bold text-center text-purple-400 mb-4 uppercase tracking-wider">Cari Pelanggan</h2>
    <input type="text" id="userInput" placeholder="Ketik nama atau ID..." 
           class="w-full bg-slate-700 border-none rounded-xl p-3 mb-4 focus:ring-2 focus:ring-purple-500 outline-none text-white">
    <button onclick="cari()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-xl transition-all shadow-lg active:scale-95">
      CARI DATA
    </button>
    <div id="loader" class="hidden text-center mt-3 text-purple-300 animate-pulse">ðŸ”Ž Mencari data...</div>
  </div>

  <div id="resultsList" class="max-w-md w-full space-y-4"></div>

  <script>
    async function cari() {
      const kueri = document.getElementById('userInput').value;
      const list = document.getElementById('resultsList');
      const loader = document.getElementById('loader');
      // Pastikan URL di bawah ini adalah URL Web App (Deployment) terbaru Anda
      const url = "https://script.google.com/macros/s/AKfycbwda6Wy5nzjt-FXxYA3fAq0VzhSgzEgl98TBnMsTVNRx_4J1SmLrXdWEg4qDiuLBlIU/exec";

      if(!kueri) return alert("Masukkan Nama atau ID!");

      list.innerHTML = "";
      loader.classList.remove('hidden');

      try {
        const response = await fetch(`${url}?id=${encodeURIComponent(kueri)}`);
        const result = await response.json();
        loader.classList.add('hidden');

        if (result.status === "success") {
          result.data.forEach(item => {
            let num = item.noHp.toString().replace(/\D/g, '');
            if (num.startsWith('0')) num = '62' + num.slice(1);
            if (!num.startsWith('62')) num = '62' + num;

            const card = `
              <div class="bg-slate-800 rounded-2xl p-5 shadow-xl border-l-4 border-purple-500">
                <div class="flex justify-between items-start mb-2">
                  <h3 class="font-bold text-purple-300 uppercase">${item.nama}</h3>
                  <span class="text-[10px] bg-slate-700 text-slate-300 px-2 py-1 rounded-md font-bold">${item.paket}</span>
                </div>
                <p class="text-xs text-slate-500 mb-3">${item.idCst} | ${item.email || '-'}</p>
                
                <div class="space-y-2 text-sm bg-slate-900/50 p-3 rounded-lg border border-slate-700 mb-4 text-slate-300">
                  <div class="flex justify-between border-b border-slate-700 pb-1">
                    <span>Tanggal Pasang:</span> 
                    <span class="font-semibold text-white">${item.tanggal.split('T')[0]}</span>
                  </div>
                  <div class="flex justify-between border-b border-slate-700 pb-1">
                    <span>Jatuh Tempo:</span> 
                    <span class="font-bold text-red-400">Tgl ${item.japo}</span>
                  </div>
                  <div class="flex flex-col pt-1">
                    <span class="text-slate-500 text-xs">Alamat Lengkap:</span>
                    <span class="text-slate-200 mt-1 italic text-xs leading-relaxed font-medium">${item.alamat || "Alamat tidak tersedia"}</span>
                  </div>
                </div>

                <a href="https://wa.me/${num}" target="_blank" 
                   class="block text-center bg-green-600 hover:bg-green-500 text-white font-bold py-2 rounded-xl transition-all shadow-md">
                  HUBUNGI WHATSAPP
                </a>
              </div>
            `;
            list.innerHTML += card;
          });
        } else {
          alert("Data tidak ditemukan!");
        }
      } catch (e) {
        loader.classList.add('hidden');
        alert("Terjadi kesalahan koneksi!");
      }
    }
  </script>
</body>
</html>



